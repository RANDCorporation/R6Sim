% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/R6Sim.R
\name{R6Sim}
\alias{R6Sim}
\title{R6 Class for a Simulation Model}
\description{
Base class for building simulation models with R6. Provides methods for managing inputs,
parameters, and simulation execution.
}
\details{
The R6Sim class includes functionality for:
* Input and parameter management
* JSON serialization
* Parallel execution
* Parameter sampling
}
\examples{
# Create simulation model
MyModel <- R6::R6Class(
  "MyModel",
  inherit = R6Sim,
  public = list(
    initialize = function(name) {
      super$initialize(name)
      self$set_input("population", 1000)
      self$set_input("growth_rate", 0.05)
    },
    simulate = function(...) {
      pop <- self$inputs$population
      growth <- self$inputs$growth_rate
      results <- pop * (1 + growth)^(1:10)
      return(data.frame(year = 1:10, population = results))
    }
  )
)

model <- MyModel$new("pop_model")
results <- model$simulate()


## ------------------------------------------------
## Method `R6Sim$set_input`
## ------------------------------------------------

model$set_input("population", 1000, type = "parameter")
model$set_input("growth_rates", c(0.01, 0.02), type = "scenario")
model$set_input("settings", list(iterations = 100), type = "config")

}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{name}}{is a character string representing the model name.}

\item{\code{inputs}}{is a list of model inputs. One can add inputs to the object with the set_input function.}

\item{\code{inputs_table}}{is a data.frame listing all inputs added to the model.}

\item{\code{params_df}}{is a data.frame containing parameters to run the model. Not to be confused with the params vector withi the inputs list, which is what should be used by the simulation model. Each column is a parameter, each row is a parameter set. The set_posterior distribution will be used to set the posterior distribution from a bayesian calibration.}

\item{\code{sim_results}}{is the object that will receive results from the simulation function.}

\item{\code{simulate_fn}}{is a function that will take as parameters self and ..., simulate the natural history of crc and returns invisible(self).}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-R6Sim-new}{\code{R6Sim$new()}}
\item \href{#method-R6Sim-set_input}{\code{R6Sim$set_input()}}
\item \href{#method-R6Sim-get_inputs}{\code{R6Sim$get_inputs()}}
\item \href{#method-R6Sim-to_json}{\code{R6Sim$to_json()}}
\item \href{#method-R6Sim-set_inputs_from_json}{\code{R6Sim$set_inputs_from_json()}}
\item \href{#method-R6Sim-set_param_dist}{\code{R6Sim$set_param_dist()}}
\item \href{#method-R6Sim-simulate}{\code{R6Sim$simulate()}}
\item \href{#method-R6Sim-setup_run}{\code{R6Sim$setup_run()}}
\item \href{#method-R6Sim-clone}{\code{R6Sim$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-new"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-new}{}}}
\subsection{Method \code{new()}}{
Create a new `R6Sim` object.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$new(name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{name}}{name of the model to be created.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
s new `R6Sim` object.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-set_input"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-set_input}{}}}
\subsection{Method \code{set_input()}}{
Set Input
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$set_input(name, value, type = NA_character_)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{name}}{Character string defining the input name}

\item{\code{value}}{Input value. Can be a single value, list or vector.}

\item{\code{type}}{Optional character string defining input type.}
}
\if{html}{\out{</div>}}
}
\subsection{Details}{
Validates input types and maintains input registry.
Accepts numeric, character, logical, data.frame and list inputs.
Type tags enable selective JSON export.
}

\subsection{Examples}{
\if{html}{\out{<div class="r example copy">}}
\preformatted{model$set_input("population", 1000, type = "parameter")
model$set_input("growth_rates", c(0.01, 0.02), type = "scenario")
model$set_input("settings", list(iterations = 100), type = "config")

}
\if{html}{\out{</div>}}

}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-get_inputs"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-get_inputs}{}}}
\subsection{Method \code{get_inputs()}}{
Get Inputs
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$get_inputs(source)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{source}}{either a path to a xlsx or yaml file, or a function that returns a named list of new inputs to be added to the model.}
}
\if{html}{\out{</div>}}
}
\subsection{Details}{
Use this function to get model inputs from a spreadsheet or yaml file
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-to_json"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-to_json}{}}}
\subsection{Method \code{to_json()}}{
Converts a `R6Sim` to a JSON string
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$to_json(input_types)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{input_types}}{vector of types of input to include in the json object.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
a JSON string containing the R6Sim objects that should be exported
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-set_inputs_from_json"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-set_inputs_from_json}{}}}
\subsection{Method \code{set_inputs_from_json()}}{
Set model Inputs from JSON string
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$set_inputs_from_json(json)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{json}}{a JSON string generated by the model_to_json function}
}
\if{html}{\out{</div>}}
}
\subsection{Details}{
Use this function to set model inputs from a JSON string. Note that the posterior distribution is not included in the json strong of model inputs.
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-set_param_dist"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-set_param_dist}{}}}
\subsection{Method \code{set_param_dist()}}{
Set distribution of model parameters
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$set_param_dist(
  params_list,
  param_dist_weights,
  cols_to_ignore = NULL,
  n_sample = 1000,
  use_average = F,
  seed = 12345678,
  resample = T
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{params_list}}{named list of one more more data.frames containing a distribution of model parameters.}

\item{\code{param_dist_weights}}{character indicating the name of the column that contain weights to be used when sampling from the posterior}

\item{\code{cols_to_ignore}}{character vector of columns name to ignore. This is useful when the posterior files contain columns that are not parameters and are not inputs to the model.}

\item{\code{n_sample}}{the size of the sample to take from each posterior file.}

\item{\code{use_average}}{T if one wants to use the average value of all parameters rather than the mean}

\item{\code{seed}}{random seed to use when sampling from the posterior}

\item{\code{resample}}{if T, samples from the posterior using the posterior weights. Otherwise, returns the full posterior, and preservers the weights.}
}
\if{html}{\out{</div>}}
}
\subsection{Details}{
Use this function to set a distribution of model parameters to the model. This is useful when we want to sample from a posterior distribution of model parameters.
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-simulate"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-simulate}{}}}
\subsection{Method \code{simulate()}}{
Runs the simulation model for a single parameter set.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$simulate(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{any set of parameters passed to this function will be passed along to the model simulate function.}
}
\if{html}{\out{</div>}}
}
\subsection{Details}{
The simulate method should be used to simulate a model run. All inputs used by the model should already have been defined before this function is called.
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-setup_run"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-setup_run}{}}}
\subsection{Method \code{setup_run()}}{
Sets parameters for a current run.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$setup_run(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{any set of parameters passed to this function will be passed along to the user natural history function.}
}
\if{html}{\out{</div>}}
}
\subsection{Details}{
This function is a wrapper around the user natural history function. It passes the `self` object and any other parameters provided to the function.
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-R6Sim-clone"></a>}}
\if{latex}{\out{\hypertarget{method-R6Sim-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{R6Sim$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
